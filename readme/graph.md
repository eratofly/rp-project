# üß™ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–¥–∞—á–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã (–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)

–≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ—à–∞–≥–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—é —Ä–∞–±–æ—Ç—ã –º–µ—Ç—Ä–∏–∫ (Prometheus + Grafana) –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.

---

## 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–û–¥–∏–Ω —Ä–∞–∑)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ (grpcurl)
–¢–∞–∫ –∫–∞–∫ —Å–µ—Ä–≤–∏—Å—ã –æ–±—â–∞—é—Ç—Å—è –ø–æ gRPC, –±—Ä–∞—É–∑–µ—Ä —Ç—É—Ç –Ω–µ –ø–æ–º–æ–∂–µ—Ç. –ù—É–∂–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ `grpcurl`.

*   **Windows:** –°–∫–∞—á–∞—Ç—å `grpcurl_..._windows_x86_64.zip` —Å [GitHub Releases](https://github.com/fullstorydev/grpcurl/releases), —Ä–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å `grpcurl.exe` –≤ –ø–∞–ø–∫—É —Å –ø—Ä–æ–µ–∫—Ç–æ–º.
*   **Linux:** `go install github.com/fullstorydev/grpcurl/cmd/grpcurl@latest`
*   **macOS:** `brew install grpcurl`

---

## 2. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

–û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª –≤ –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

1.  **–°–±–æ—Ä–∫–∞:**
    ```bash
    brewkit build
    ```
2.  **–ó–∞–ø—É—Å–∫ (—Å –ø–µ—Ä–µ—Å–±–æ—Ä–∫–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤):**
    ```bash
    docker compose up --build -d
    ```
3.  **–ü—Ä–æ–≤–µ—Ä–∫–∞:**
    –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (–æ—Å–æ–±–µ–Ω–Ω–æ `...-message-handler`) —Ä–∞–±–æ—Ç–∞—é—Ç:
    ```bash
    docker compose ps
    ```

---

## 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Grafana (–î–ª—è –∫—Ä–∞—Å–∏–≤–æ–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏)

–ú—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∂–∏–º **Explore**, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

1.  –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: [http://localhost:3000](http://localhost:3000) (Login/Password: `admin` / `admin`).
2.  –í –º–µ–Ω—é —Å–ª–µ–≤–∞ –Ω–∞–∂–º–∏—Ç–µ –∏–∫–æ–Ω–∫—É **–ö–æ–º–ø–∞—Å–∞** (Explore).
3.  –í–≤–µ—Ä—Ö—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ –≤—ã–ø–∞–¥–∞—é—â–µ–º —Å–ø–∏—Å–∫–µ –≤—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫ **Prometheus**.
4.  –°–ø—Ä–∞–≤–∞ —Å–≤–µ—Ä—Ö—É, —Ä—è–¥–æ–º —Å –∫–Ω–æ–ø–∫–æ–π "Run query", –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–µ–ª–æ—á–∫—É —Ä—è–¥–æ–º —Å –∫–Ω–æ–ø–∫–æ–π –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –≤—ã–±–µ—Ä–∏—Ç–µ **5s** (–∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥).

---

## 4. –°—Ü–µ–Ω–∞—Ä–∏–π —Å–¥–∞—á–∏ ‚Ññ1: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö (User Service)

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º:** –ú—ã –¥–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–∏—Å—É, –æ–Ω –∏–¥–µ—Ç –≤ MySQL, –∏ –º—ã –≤–∏–¥–∏–º —ç—Ç–æ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ.

1.  **–í Grafana:**
    –í –ø–æ–ª–µ **Metric** –≤–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π –≤ —Å–µ–∫—É–Ω–¥—É):
    ```
    rate(user_database_query_duration_seconds_count[1m])
    ```
    –ù–∞–∂–º–∏—Ç–µ **Run query**. –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –≥—Ä–∞—Ñ–∏–∫ –±—É–¥–µ—Ç –ø—É—Å—Ç–æ–π –∏–ª–∏ –ª–µ–∂–∞—Ç—å –Ω–∞ –Ω—É–ª–µ.

2.  **–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:**
    –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 5-10 —Ä–∞–∑ –ø–æ–¥—Ä—è–¥ (–º–µ–Ω—è–π—Ç–µ `login`, –µ—Å–ª–∏ –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞, —á—Ç–æ —Ç–∞–∫–æ–π —É–∂–µ –µ—Å—Ç—å):
    ```bash
    grpcurl -plaintext -d '{"user": {"login": "student_demo", "status": 1, "email": "demo@test.com"}}' localhost:8081 User.UserInternalService/StoreUser
    ```

3.  **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
    –ü–æ–¥–æ–∂–¥–∏—Ç–µ 10-15 —Å–µ–∫—É–Ω–¥. –í –ì—Ä–∞—Ñ–∞–Ω–µ –ª–∏–Ω–∏—è —Ä–µ–∑–∫–æ –ø–æ–π–¥–µ—Ç –≤–≤–µ—Ä—Ö.
    *   **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—é:** *"–Ø —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î. –í–æ—Ç –º—ã –≤–∏–¥–∏–º –≤—Å–ø–ª–µ—Å–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π."*

---

## 5. –°—Ü–µ–Ω–∞—Ä–∏–π —Å–¥–∞—á–∏ ‚Ññ2: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –°–æ–±—ã—Ç–∏–π (Notification Service)

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º:** `UserService` –∫–∏–¥–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ -> `RabbitMQ` -> `NotificationService` —á–∏—Ç–∞–µ—Ç –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç. –ú—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–º –∏–º–µ–Ω–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∫—É –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–±—ã—Ç–∏—è.

1.  **–í Grafana:**
    –û—á–∏—Å—Ç–∏—Ç–µ –ø–æ–ª–µ Metric –∏ –≤–≤–µ–¥–∏—Ç–µ:
    ```
    notification_event_processing_duration_seconds_count
    ```
    –ù–∞–∂–º–∏—Ç–µ **Run query**. –ó–∞–ø–æ–º–Ω–∏—Ç–µ —Ç–µ–∫—É—â–µ–µ —á–∏—Å–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 2).

2.  **–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:**
    –°–æ–∑–¥–∞–π—Ç–µ –µ—â–µ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—ç—Ç–æ —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç —Å–æ–±—ã—Ç–∏–µ "user_created"):
    ```bash
    grpcurl -plaintext -d '{"user": {"login": "event_test_user", "status": 1}}' localhost:8081 User.UserInternalService/StoreUser
    ```

3.  **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
    –ß–µ—Ä–µ–∑ 5-10 —Å–µ–∫—É–Ω–¥ —á–∏—Å–ª–æ –≤ –ì—Ä–∞—Ñ–∞–Ω–µ —É–≤–µ–ª–∏—á–∏—Ç—Å—è (–±—ã–ª–æ 2 -> —Å—Ç–∞–ª–æ 3).
    *   **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—é:** *"–°–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—É—á–∏–ª —Å–æ–±—ã—Ç–∏–µ —á–µ—Ä–µ–∑ RabbitMQ. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–ª —É—Å–ø–µ—à–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–±—ã—Ç–∏—è –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ."*

---

## 6. –°—Ü–µ–Ω–∞—Ä–∏–π —Å–¥–∞—á–∏ ‚Ññ3: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –û—à–∏–±–æ–∫

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º:** –ú—ã –≤–∏–¥–∏–º –Ω–µ —Ç–æ–ª—å–∫–æ —É—Å–ø–µ—Ö–∏, –Ω–æ –∏ –æ—à–∏–±–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã).

1.  **–í Grafana:**
    –í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏–º–µ–Ω–Ω–æ –æ—à–∏–±–æ–∫:
    ```
    user_database_query_duration_seconds_count{status="error"}
    ```
    –ù–∞–∂–º–∏—Ç–µ **Run query**.

2.  **–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:**
    –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞–π—Ç–∏ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤–≤–µ–¥–∏—Ç–µ —Å–ª—É—á–∞–π–Ω—ã–π ID):
    ```bash
    grpcurl -plaintext -d '{"userID": "11111111-2222-3333-4444-555555555555"}' localhost:8081 User.UserInternalService/FindUser
    ```
    –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≤—ã —É–≤–∏–¥–∏—Ç–µ: `ERROR: user not found`.

3.  **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
    –í –ì—Ä–∞—Ñ–∞–Ω–µ —Å—á–µ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –≤—ã—Ä–∞—Å—Ç–µ—Ç.
    *   **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—é:** *"–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–∞–∑–ª–∏—á–∞–µ—Ç —É—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏ –æ—à–∏–±–∫–∏. –í–æ—Ç –º—ã –≤–∏–¥–∏–º –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ—à–∏–±–∫—É –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –ë–î."*

---

## –®–ø–∞—Ä–≥–∞–ª–∫–∞: –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤, –ø—Ä–æ—Å—Ç–æ –º–µ–Ω—è–π—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è:

*   **Payment Service (–ë–î):** `payment_database_query_duration_seconds_count`
*   **Product Service (–ë–î):** `product_database_query_duration_seconds_count`
*   **Notification Service (–ë–î):** `notification_database_query_duration_seconds_count`